<html>
    <head>
        <title>network-graph</title>
        <script src="/socket.io/socket.io.js" type='text/javascript'></script>
        <script src="/jquery.js" type="text/javascript"></script>
	<script src="/jquery.flot.js" type="text/javascript"></script>
	<style type='text/css'>
		body{
			font-family: Arial;
			font-size: 120%;
		}
		.box {
			padding: 10px;
			background-color: #eee;
			border: 1px solid #ccc;
			width: 835px;
		}
		.messages{
			font-weight: bold;
		}
		#debug{
			font-size: 60%;
		}
		#graph{
			width: 800px;
			height: 200px;
			margin: 25px;
		}
	</style>
    </head>
<body>
	<h1>network-graph</h1>
	<div class='box messages'>Currently: <span id='status'></span></div>
	<div id='graph'></div>
	<div class='messages'>Debug:</div>
	<div id='debug' class='box'></div>
	<script type='text/javascript'>
		var globalDataArray	= Array( );
		var plotInstance	= $.plot( "#graph", globalDataArray );

		$(document).ready( function( ){
			function esc( msg ){
				return msg.toString().replace(/</g, '&lt;').replace(/>/g, '&gt;');
			}

			function message( msg ){
				$("#status").html( esc( msg ) + "<br />\n" );
			}

			function handleInformation( obj ){
				var current_cap_time	= obj.current_cap_time;
				var session_key		= obj.session_key;
				var status		= obj.status;

				$("#debug").append( current_cap_time + ", " + session_key + " " + status + "<br>\n" );
			}

			message( "Starting up socket.io" );
			
			var socket	= new io.Socket( null, { port: 8080, rememberTransport: false } );
			socket.connect( );

			socket.on( 'message', function( obj ){ handleInformation( obj ); } );
			socket.on( 'connect', function( ){ message( 'Connected' ); } );
			socket.on( 'disconnect', function( ){ message( 'Disconnected' ); } );
		});
	</script>
</body>
</html>
