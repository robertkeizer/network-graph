<html>
    <head>
        <title>network-graph</title>
        <script src="/socket.io/socket.io.js" type='text/javascript'></script>
        <script src="/jquery.js" type="text/javascript"></script>
	<script src="/jquery.flot.js" type="text/javascript"></script>
	<style type='text/css'>
		body{
			font-family: Arial;
			font-size: 120%;
		}
		.box {
			padding: 10px;
			background-color: #eee;
			border: 1px solid #ccc;
			width: 835px;
		}
		.messages{
			font-weight: bold;
		}
		#debug{
			font-size: 60%;
		}
		#graph{
			width: 800px;
			height: 200px;
			margin: 25px;
		}
	</style>
    </head>
<body>
	<h1>network-graph</h1>
	<div class='box messages'>Currently: <span id='status'></span></div>
	<div id='graph'></div>
	<div class='messages'>Debug:</div>
	<div id='debug' class='box'></div>
	<script type='text/javascript'>
		// Defined outside the ready function ( debugging purposes ).
		var globalDataArray	= Array( );
		var plotInstance;

		$(document).ready( function( ){
			plotInstance	= $.plot( "#graph", globalDataArray );

			function esc( msg ){
				return msg.toString().replace(/</g, '&lt;').replace(/>/g, '&gt;');
			}

			function message( msg ){
				$("#status").html( esc( msg ) + "<br />\n" );
			}

			function handleInformation( obj ){
				var current_cap_time	= obj.current_cap_time;
				var session_key		= obj.session_key;
				var status		= obj.status;

				$("#debug").append( current_cap_time + ", " + session_key + " " + status + "<br>\n" );

				if( status == 'start' ){
					// Check to see if there is an array already open with this session_key. If not, create one.
					if( typeof globalDataArray[session_key] === 'undefined' ){
						$("#debug").append( "NEW Session key!<br>\n" );
						globalDataArray[session_key]	= new Array( );
					}else{
						$("#debug").append( "USING Session key!<br>\n" );
					}
					
					// Push the current_cap_time onto the dataArray. 2nd value is .length ( or the count ).
					globalDataArray[session_key].push( current_cap_time, globalDataArray[session_key].length );

				}else if( status == 'end' ){
					// Go through the number of sessions with session_key, decrement by one until 0, then remove the array.
					
				}
			}

			message( "Starting up socket.io" );
			
			var socket	= new io.Socket( null, { port: 8080, rememberTransport: false } );
			socket.connect( );

			socket.on( 'message', function( obj ){ handleInformation( obj ); } );
			socket.on( 'connect', function( ){ message( 'Connected' ); } );
			socket.on( 'disconnect', function( ){ message( 'Disconnected' ); } );
		});
	</script>
</body>
</html>
