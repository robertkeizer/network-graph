<html>
    <head>
        <title>network-graph</title>
        <script src="/socket.io/socket.io.js" type='text/javascript'></script>
        <script src="/jquery.js" type="text/javascript"></script>
	<script src="/jquery.flot.js" type="text/javascript"></script>
	<style type='text/css'>
		body{
			font-family: Arial;
			font-size: 120%;
		}
		.box {
			padding: 10px;
			background-color: #eee;
			border: 1px solid #ccc;
		}
		#messages{
			font-weight: bold;
		}
		#debug{
			font-size: 60%;
		}
		#graph{
			width: 800px;
			height: 200px;
			margin: 25px;
		}
	</style>
    </head>
<body>
	<h1>network-graph</h1>
	<div id='messages' class='box'>Currently: <span id='status'></span></div>
	<div id='graph'></div>
	<div id='debug' class='box'></div>
	<script type='text/javascript'>
		$(document).ready( function( ){
			function esc( msg ){
				return msg.toString().replace(/</g, '&lt;').replace(/>/g, '&gt;');
			}

			function message( msg ){
				$("#status").html( esc( msg ) + "<br />\n" );
			}

			function handleInformation( obj ){
				var dateObj	= new Date( obj.dateObj );
				var saddr	= obj.saddr;
				var daddr	= obj.daddr;

				$("#debug").append( dateObj.getTime() + " " + saddr + " -> " + daddr + '<br>\n' );
			}

			message( "Starting up socket.io" );
			
			var socket	= new io.Socket( null, { port: 8080, rememberTransport: false } );
			socket.connect( );

			socket.on( 'message', function( obj ){ handleInformation( obj ); } );
			socket.on( 'connect', function( ){ message( 'Connected' ); } );
			socket.on( 'disconnect', function( ){ message( 'Disconnected' ); } );

			message( "Starting up flot" );
			var plotInstance	= $.plot( "#graph", [ [0,1],[1,2],[2,4] ] );
		});
	</script>
</body>
</html>
